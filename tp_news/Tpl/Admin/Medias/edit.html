<style type="text/css" media="screen">
.my-uploadify-button {
	background:none;
	border: none;
	text-shadow: none;
	border-radius:0;
}

.uploadify:hover .my-uploadify-button {
	background:none;
	border: none;
}

.fileQueue {
	width: 400px;
	height: 150px;
	overflow: auto;
	border: 1px solid #E5E5E5;
	margin-bottom: 10px;
}
p { width: 300px; }

</style>

<form id="mediaForm" method="post" action="" class="pageForm required-validate" 
	onsubmit="return validateCallback(this, navTabAjaxDone1);">
	<input type="hidden" name="fileUrl" value="">
	<input type="hidden" name="fileList" value="">
</form>


<div class="pageContent">
		<div class="pageFormContent" style="padding: 5px 5px;" layoutH="45">
			<p style="padding: 5px 0;height: 25px;">
                 <label>选择要上传的文件：</label>
                 <label><input id="testFileInput2" type="file" name="image"/></label>
            </p>
            <p style="padding: 5px 0;width: 100%;">
                 <label>上传文件最大尺寸：</label>
                 <label>32MB</label>
            </p>
            <p style="padding: 5px 0;width: 100%;">
                 <label style="width:auto;">文件上传之后，您可以为它添加标题和描述。</label>
            </p>
            <div id="tttlest" class="divider"></div>
            
            
            <div id="fileQueue" class="fileQueue" style="width: 650px;height: 50px;border: 0px solid #E5E5E5;display: none;"></div>
            
             
            <table id="templeate" cellpadding="0" cellspacing="0" width="70%" style="border: 1px solid #E5E5E5;display: none;">
            	<tr>
            		<td width="20%"><img width="40" height="40" src="" alt="" style="margin-left: 0px; display: inline;"></td>
            		<td class="name"></td>
            		<td width="15%" align="center"><a class="describe-toggle-on" href="#" style="display: block;">显示</a></td>
            	</tr>
            	<tr class="fullTr" style="display: none;">
            		<td colspan="3" style="border-top: 1px solid #E5E5E5;padding-left: 10px;">
            			<table style="display: table;">
							<thead class="media-item-info" id="media-head-64">
								<tr valign="top" style="height: 170px;">
									<td class="A1B1" id="thumbnail-head-64">
									<p style="width: 250px;"><a href="" target="_blank"><img class="thumbnail" src="" height="150" width="150" alt="" style="margin-top: 3px"></a></p>
									</td>
									<td>
									<p style="height: 5px"></p>
									<p class="filename"><strong>文件名：</strong> <span></span></p>
									<p class="filetype"><strong>文件类型：</strong> <span></span></p>
									<p class="filetime"><strong>上传日期：</strong> <span></span></p>
									<p class="filesize"><strong>尺寸：</strong> <span></span></p>
								</td></tr>
							</thead>
							<tbody>
								<tr><td colspan="2" class="imgedit-response" id="imgedit-response-64"></td></tr>
								<tr class="post_title form-required">
									<th valign="top" scope="row" class="label" style="height: 30px;"><label for="attachments[64][post_title]"><span class="alignleft">标题</span><span class="alignright"><abbr title="required" class="required">*</abbr></span><br class="clear"></label></th>
									<td class="field"><input type="text" class="text" id="attachments[64][post_title]" name="attachments[64][post_title]" value="" aria-required="true" style="width: 460px;"></td>
								</tr>
								<tr class="image_alt">
									<th valign="top" scope="row" class="label"><label for="attachments[64][image_alt]"><span class="alignleft">替代文本</span><br class="clear"></label></th>
									<td class="field"><input type="text" class="text" id="attachments[64][image_alt]" name="attachments[64][image_alt]" value="" style="width: 460px;"><p class="help">图像的替代文本，例如“蒙娜丽莎”</p></td>
								</tr>
								<tr class="post_excerpt">
									<th valign="top" scope="row" class="label" style="height: 30px;"><label for="attachments[64][post_excerpt]"><span class="alignleft">说明</span><br class="clear"></label></th>
									<td class="field"><input type="text" class="text" id="attachments[64][post_excerpt]" name="attachments[64][post_excerpt]" value="" style="width: 460px;"></td>
								</tr>
								<tr class="post_content">
									<th valign="top" scope="row" class="label" style="height: 50px;"><label for="attachments[64][post_content]"><span class="alignleft">描述</span><br class="clear"></label></th>
									<td class="field"><textarea id="attachments[64][post_content]" name="attachments[64][post_content]" style="width: 460px;"></textarea></td>
								</tr>
								<tr class="image_url">
									<th valign="top" scope="row" class="label"><label for="attachments[64][image_url]"><span class="alignleft">文件 URL</span><br class="clear"></label></th>
									<td class="field">
										<input type="text" class="text urlfield" readonly="readonly" name="image_url" value="" style="width: 460px;">
										<!-- <br><p class="help">上传文件的位置。<a href="__APP__/admin/medias/deleteUpload" target="ajaxTodo" class="del-link">删除</a></p> -->
										<br><p class="help">上传文件的位置。<a href="javascript:void(0)" class="del-link" onclick="deleteUpload(this)">删除</a></p>
									</td>
								</tr>
							</tbody>
						</table>
            		</td>
            	</tr>
            </table>
		</div>
		<div class="formBar">
			<ul>
				<li><div class="buttonActive"><div class="buttonContent"><button type="button" onclick="saveUpload();">提交</button></div></div></li>
				<li><div class="button"><div class="buttonContent"><button type="button" class="close">取消</button></div></div></li>
			</ul>
		</div>
	</div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    $("#testFileInput2").uploadify({
    	swf:'__DWZ__/uploadify/scripts/uploadify.swf',
        uploader:'__APP__/admin/medias/upload',
        formData:{PHPSESSID:'xxx', ajax:1},
        queueID:'fileQueue',
        buttonImage:'__DWZ__/uploadify/img/add.jpg',
        buttonClass:'my-uploadify-button',
        width:102,
        auto:true,
		multi:true,
		onUploadSuccess : function(file, data, response) {
			var dataObj = jQuery.parseJSON(data);
			if(dataObj.status == 0){
				alertMsg.info(dataObj.info);
				return;
			}
			onUploadSuccess(file, dataObj, response);
        },
		//onQueueComplete:uploadifyQueueComplete1,
		onSelect:initDiv
    });
    function onUploadSuccess(file, data, response){
    	var name = data.filename.split(".")[0];
    	var templeate = "<table id='"+name+"' cellpadding='0' cellspacing='0' width='70%' style='border: 1px solid #E5E5E5;'>"
    		+ $("#templeate").html()
    		+"</table>";
    	$("#tttlest").after(templeate);
    	$("#"+name+" img").attr("src",data.fileurl);
    	$("#"+name+" .name").html(data.filename);
    	$("#"+name+" .filename span").html(data.filename);
    	$("#"+name+" .filetype span").html(data.filetype);
    	$("#"+name+" .filetime span").html(data.filetime);
    	$("#"+name+" .filesize span").html(data.filesize);
    	$("#"+name+" .post_title input").val(data.filetitle);
    	$("#"+name+" .image_url input").val(data.fileurl);
    	$("#"+name+" .describe-toggle-on").toggle(
		  function(){
		  	$("#"+name+" .fullTr").show();
		  },
		  function(){
		  	$("#"+name+" .fullTr").hide();
		  }
		);
    	$("#"+name+" a[target='ajaxTodo']").ajaxTodo();
    }
    function initDiv(){
    }
    
});  
function deleteUpload(thiz){
	var actionURL = "__APP__/admin/medias/deleteUpload";
	var image_url = $(thiz).parent().prev().prev();
	var mediaForm = $("#mediaForm");
	mediaForm.attr("action", actionURL);
	mediaForm.find("[name='fileUrl']").val(image_url.val());
	mediaForm.submit();
}
function saveUpload(){
	var actionURL = "__APP__/admin/medias/saveUpload";
	var mediaForm = $("#mediaForm");
	mediaForm.attr("action", actionURL);
	var fileVal = "";
	$(".name").each(function(index){
		var thizVal = $(this).html();
		if(thizVal != ""){
			fileVal += thizVal+",";
		}
	});
	mediaForm.find("[name='fileList']").val(fileVal);
	mediaForm.submit();
}
function navTabAjaxDone1(json){
	if(json.statusCode == 200){
		$("#"+json.filename).remove();
	}
    DWZ.ajaxDone(json);
}


</script>